# 检查事件记录问题

如果 events JSON 文件是空的，请按照以下步骤检查：

## 步骤 1: 检查界面状态

1. **查看监听状态显示**
   - 在应用界面上，应该有一个显示"键盘鼠标监听"状态的标签
   - 如果显示"未启用"，说明当前使用的是基础版本（仅录制屏幕）

2. **检查复选框**
   - 找到"启用键盘和鼠标事件记录（需要辅助功能权限）"复选框
   - **必须勾选**此选项才能记录键盘鼠标事件

## 步骤 2: 启用键盘鼠标监听

1. **勾选选项**
   - 在应用界面上勾选"启用键盘和鼠标事件记录"复选框
   - 会弹出提示，说明需要授权和重新开始录制

2. **授予权限（macOS）**
   - 打开"系统设置" > "隐私与安全性" > "辅助功能"
   - 找到"录屏软件"并勾选

3. **重新开始录制**
   - **重要**：切换选项后，必须重新开始录制才能生效
   - 如果正在录制，先停止录制
   - 然后重新点击"开始录制"

## 步骤 3: 查看调试信息

运行测试脚本查看详细输出：

```bash
./测试应用.sh
```

应该看到：
- "键盘监听已启动"
- "鼠标监听已启动"
- "记录鼠标点击: ..."（当你点击时）
- "保存事件: 队列中有 X 个事件"

## 步骤 4: 检查事件文件

停止录制后，检查 events JSON 文件：

```bash
cat recordings/events_*.json
```

如果文件是空的 `[]`，可能的原因：

1. **没有勾选选项** - 检查界面上的复选框是否已勾选
2. **没有重新开始录制** - 切换选项后必须重新开始录制
3. **没有授予权限** - macOS 需要在系统设置中授权
4. **监听器启动失败** - 查看控制台输出中的错误信息
5. **录制期间没有操作** - 确保在录制时进行了键盘或鼠标操作

## 快速诊断

运行以下命令查看最近的 events 文件：

```bash
# 查看最新的 events 文件
ls -lt recordings/events_*.json | head -1 | awk '{print $NF}' | xargs cat

# 或者查看所有 events 文件的大小
ls -lh recordings/events_*.json
```

如果文件大小都是 2 字节（只有 `[]`），说明没有记录任何事件。

## 解决方案

### 方案 1: 确保正确启用（推荐）

1. 勾选"启用键盘和鼠标事件记录"复选框
2. 在系统设置中授予辅助功能权限
3. **停止当前录制**（如果有）
4. **重新开始录制**
5. 进行一些键盘和鼠标操作
6. 停止录制
7. 检查 events 文件

### 方案 2: 查看控制台输出

如果仍然不行，运行 `./测试应用.sh` 并查看：
- 是否有"键盘监听已启动"和"鼠标监听已启动"的消息
- 是否有任何错误信息
- 停止录制时是否显示"保存了 X 个事件"

### 方案 3: 检查权限

macOS 用户：
- 系统设置 > 隐私与安全性 > 辅助功能
- 确保"录屏软件"已勾选
- 如果不在列表中，先启动应用并勾选选项，系统会提示

Windows 用户：
- 可能需要以管理员身份运行应用

